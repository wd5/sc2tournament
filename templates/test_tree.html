<html>
<head>
    <script type="text/javascript" src="{{ STATIC_URL }}js/raphael-min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/dracula_graffle.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/dracula_graph.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/dracula_algorithms.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/binary_tree.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/tourney_manage.js"></script>
    {# Let's host this locally asap #} 
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/login.css" />
    <style type="text/css">
      div#canvas {
      	border: 1px solid black;
      }
    </style>
    <script type="text/javascript">
    /* Get variables from template and use this to render tournament */
    $(document).ready(function() {
		//renderTournament({{ tournament_id }});
		//setInterval(function (){ renderTournament({{ tournament_id }}); }, 0000);
	});
    </script>
</head>
<body>
<h1>Tournament #{{ tournament_id }} - {{ t.name }} # {{ t.status }}</h1>

{# Canvas stuff ... #}

<canvas id="myCanvas" width="300" height="150">
Fallback content, in case the browser does not support Canvas.
</canvas>
<script>
  function importCanvas(sourceCanvas, targetSVG) {
      // get base64 encoded png data url from Canvas
      var img_dataurl = sourceCanvas.toDataURL("image/png");
  
      var svg_img = document.createElementNS(
          "http://www.w3.org/2000/svg", "image");
      return img_dataurl; 
      /*
      svg_img.setAttributeNS(
          "http://www.w3.org/1999/xlink", "xlink:href", img_dataurl);
  
      targetSVG.appendChild(svg_img);*/
  }
  $(document).ready().delay(2000).queue( function() {
          importCanvas(document.getElementById('myCanvas'), $('#canvas').children('svg')[0]);
  }).delay(2000).queue( function() {
          renderSvg();
          //$("#canvas").children('svg').children('image').attr("x","730").attr("y","498").attr("width","200").attr("height","200");
  });
</script>
<script>
// Get a reference to the element.
var elem = document.getElementById('myCanvas');

// Always check for properties and methods, to make sure your code doesn't break 
// in other browsers.
if (elem && elem.getContext) {
  // Get the 2d context.
  // Remember: you can only initialize one context per element.
  var context = elem.getContext('2d');
  if (context) {
    // You are done! Now you can draw your first rectangle.
    // You only need to provide the (x,y) coordinates, followed by the width and 
    // height dimensions.
    context.fillRect(0, 0, 150, 100);
  }
}
</script>
{# Check to see if we should show them the admin stuff #}
{% ifequal t.organized_by.id request.user.id %}
<style type="text/css">
    #pending_teams {
      float:left; 
      width: 300px;
      color: red;
    } 
    #accepted_teams {
      float:left;
      width: 300px;
      color: green;
    }
    #admin ul li ul {
      display:none;
    }
    #error {
	display:none;
	color:red;
    }
    .loading {
	color:gray;
    }
    #pending_list, #accepted_list { list-style-type: none; margin: 0; padding: 0; float: left; margin-right: 10px; background: #eee; padding: 5px}
    #pending_list li, #accepted_list li {}
</style>
<div id="admin">	
	<p>Click on the team name to accept or reject this team into your tournament...</p>
	<div id="error"> 
	</div>
	<div id="pending_teams" data-post-url="{% url sc2tournament.views.tournament_accept %}">
		<ul id="pending_list">
			<lh>Teams Pending</lh>
		{% for team in t.pending_teams.all %}
			<li>
				<form id="form_accept_{{ team.id }}" method="post" action="{% url sc2tournament.views.tournament_accept %}">
					{% csrf_token %}
					<input type="hidden" name="team_id" value="{{ team.id }}" />
					<input type="hidden" name="tournament_id" value="{{ t.id }}" />
					<a class="pending team">{{ team }}</a> <span onclick="$(this).find('ul').toggle()">(+)</a>
					<ul>
						{% for member in team.members.all %}
							<li>{{ member }}</li>
						{% endfor %}
					</ul>
				</form>
			</li>
		{% endfor %}
		</ul>
	</div>
	<div id="accepted_teams" data-post-url="{% url sc2tournament.views.tournament_reject %}">
		<ul id="accepted_list">
			<lh>Teams accepted</lh>
		{% for team in t.competing_teams.all %}
			<li>
				<form id="form_reject_{{ team.id }}" method="post" action="{% url sc2tournament.views.tournament_reject %}">
					{% csrf_token %}
					<input type="hidden" name="team_id" value="{{ team.id }}" />
					<input type="hidden" name="tournament_id" value="{{ t.id }}" />
					<a class="accepted team">{{ team }}</a> <span onclick="$(this).next().is(':visible') ? $(this).next().fadeOut(100) : $(this).next().fadeIn(); $(this).text($(this).text() == '(+)' ? '(-)' : '(+)')">(+)</span>
					<ul>
						{% for member in team.members.all %}
							<li>{{ member }}</li>
						{% endfor %}
					</ul>
				</form>
			</li>
		{% endfor %}
		</ul>
	</div>
	<form method="post" action="{% url sc2tournament.views.tournament_start %}">.
		{% csrf_token %}
		<input type="hidden" name="value" value="yes" />
		<input type="hidden" name="tournament_id" value="{{ t.id }}" />
		<input type="submit" value="Start the Tournament!" />
	</form>	
</div>
{% endifequal %}

{# Only show the tournament chart if the tournament hasn't started yet #}
{% ifnotequal t.status "org" %}
<div id="canvas"></div>
{% endifnotequal %}
<div style="clear:both"></div>


<div id="svg">

</div>
<script>
      function getBadge(badge_id) {
          // Nine arguments: the element, source (x,y) coordinates, source width and 
          // height (for cropping), destination (x,y) coordinates, and destination width 
          // and height (resize).
          context.drawImage(img_elem, sx, sy, sw, sh, dx, dy, dw, dh);
      }
      function renderSvg() {
           var paper = Raphael("svg", 500,500);
           var img = paper.image(importCanvas($("myCanvas")[0]), 0,0,270,270);
       }
</script>
</body>
</html>
